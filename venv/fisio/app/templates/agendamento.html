{% extends "base.html" %}
{% load static %}

{% block body %}

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-danger mt-3 mensagem-alert" role="alert">
            {{ message }}
        </div>
    {% endfor %}
    <script>
        
    </script>
{% endif %}

<div class="container mt-5">
    <div class="row">
        <div class="col-md-6 offset-md-3">
            <h2 class="mb-4">Agendamento de Consulta</h2>
            <!-- Formulário de Agendamento -->
            <form method="post" action="{% url 'agendamento' %}">
                {% csrf_token %}        
                <div class="form-group">
                    <label for="nome">Nome Completo:</label>
                    <input type="text" class="form-control" id="nome" name="nome" required>
                    {% if form.nome.errors %}
                        <span class="text-danger">{{ form.nome.errors.0 }}</span>
                    {% endif %}
                </div>
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                    {% if form.email.errors %}
                        <span class="text-danger">{{ form.email.errors.0 }}</span>
                    {% endif %}
                </div>
                <div class="form-group">
                    <label for="telefone">Telefone:</label>
                    <input type="tel" class="form-control" id="telefone" name="telefone" oninput="formatarTelefone(this)" required>
                    {% if form.telefone.errors %}
                        <span class="text-danger">{{ form.telefone.errors.0 }}</span>
                    {% endif %}
                </div>                
                <div class="form-group">
                    <label for="data">Data da Consulta:</label>
                    <input type="date" class="form-control" id="data" name="data" required>
                    {% if form.data.errors %}
                        <span class="text-danger">{{ form.data.errors.0 }}</span>
                    {% endif %}
                </div>
                <div class="form-group">
                    <label for="horario">Horário da Consulta:</label>
                    <input type="time" class="form-control" id="horario" name="horario" required>
                    {% if form.horario.errors %}
                        <span class="text-danger">{{ form.horario.errors.0 }}</span>
                    {% endif %}
                </div>
                <div class="form-group">
                    <label for="mensagem">Mensagem Adicional:</label>
                    <textarea class="form-control" id="mensagem" name="mensagem" rows="3"></textarea>
                    {% if form.mensagem.errors %}
                        <span class="text-danger">{{ form.mensagem.errors.0 }}</span>
                    {% endif %}
                </div>
                <button type="submit" class="btn btn-primary">Agendar Consulta</button>
            </form>
            <script>
                function formatarTelefone(input) {
                    // Remove todos os caracteres não numéricos do número de telefone
                    var numeroLimpo = input.value.replace(/\D/g, '');
            
                    // Verifica se o número é um número de telefone válido
                    if (numeroLimpo.length === 11) {
                        input.value = '(' + numeroLimpo.substring(0, 2) + ') ' + numeroLimpo.substring(2, 7) + '-' + numeroLimpo.substring(7);
                    }
                    // Se não for válido, mantém o valor original
                    else {
                        input.value = numeroLimpo;
                    }
                }

            </script>
        </div>
    </div>
</div>

{% endblock %}
